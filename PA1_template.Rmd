---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
activity_file <- read.csv("activity.csv")
cleaned_activity_file <- na.omit(activity_file)


## What is mean total number of steps taken per day?
total_steps_per_day <- summarise(group_by(cleaned_activity_file, date), total_steps = sum(steps))

mean_total_steps_per_day <- mean(total_steps_per_day$total_steps)
median_total_steps_per_day <- median(total_steps_per_day$total_steps)
with(total_steps_per_day, hist(total_steps, main = "Histogram of Total Steps per Day", xlab = "Total Steps per Day", col = "light green"))


## What is the average daily activity pattern?
mean_total_steps_per_interval <- summarise(group_by(cleaned_activity_file, interval), average_steps = mean(steps))

highest_interval <- paste("0", head(mean_total_steps_per_interval[order(mean_total_steps_per_interval$average_steps, decreasing = TRUE),], 1)$interval, sep="")

with(mean_total_steps_per_interval, plot(interval, average_steps, type = "l", col="green", main = "Average Daily Activity Pattern", xlab = "Hours of the Day", ylab = "Average steps across all days"))
axis(side=1, at=seq(0, 2355, by=500))


## Imputing missing values
observations_with_nas <- sum(!complete.cases(activity_file))

imputed_activity_file <- activity_file
for(i in 1:nrow(activity_file)) {
    if(is.na(activity_file[i,]$steps)){ 
        imputed_activity_file[i,]$steps <- as.integer(round(subset(mean_total_steps_per_interval, select = c(average_steps), interval == activity_file[i,]$interval), digits = 0) )}
}

total_imputed_steps_per_day <- summarise(group_by(imputed_activity_file, date), total_steps = sum(steps))


mean_total_imputed_steps_per_day <- mean(total_imputed_steps_per_day$total_steps)

median_total_imputed_steps_per_day <- median(total_imputed_steps_per_day$total_steps)

with(total_imputed_steps_per_day, hist(total_steps, main = "Histogram of Total Imputed Steps per Day", xlab = "Total Imputed Steps per Day", col = "light green"))


## Are there differences in activity patterns between weekdays and weekends?
weekend <- "Weekend"
weekday <- "Weekday"
imputed_steps_per_day_with_day_type <- imputed_activity_file
imputed_steps_per_day_with_day_type$day_type <- ifelse(weekdays(as.Date(imputed_activity_file$date)) == "Sunday", weekend, ifelse(weekdays(as.Date(imputed_activity_file$date)) == "Saturday", weekend, weekday))

mean_imputed_steps_per_day_with_day_type <- summarise(group_by(imputed_steps_per_day_with_day_type, interval, day_type), mean_steps = mean(steps))

xyplot(mean_imputed_steps_per_day_with_day_type$mean_steps ~ mean_imputed_steps_per_day_with_day_type$interval | mean_imputed_steps_per_day_with_day_type$day_type, mean_imputed_steps_per_day_with_day_type, col="green", layout = c(1, 2), type = "l", xlab = "Interval", ylab = "Steps", par.settings = list(strip.background=list(col="lightgrey")))
